<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>AI Book Generator</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; }
    #log { background: #111; color: #0f0; padding: .5rem 1rem; height: 300px; overflow-y: auto; font-size: 13px; white-space: pre; }
    button { padding: .5rem 1rem; font-size: 1rem; }
  </style>
</head>
<body>
  <h1>AI Book Generator</h1>
  <label>Keywords: <input id="keywords" value="Artificial Intelligence"/></label>
  <label>Pages: <input id="pages" type="number" value="120" min="10" max="500"/></label>
  <button onclick="generate()">Generate</button>
  <button onclick="downloadBook()">Download</button>
  <h2>Live log</h2>
  <div id="log"></div>

  <script>
    const logBox = document.getElementById('log');
    function append(line) { logBox.textContent += line + '\n'; logBox.scrollTop = logBox.scrollHeight; }

    const evt = new EventSource('/logs');
    evt.onmessage = e => append(e.data);

    async function generate() {
      const kw = document.getElementById('keywords').value || 'Artificial Intelligence';
      const pg = document.getElementById('pages').value || 120;
      append('[HTTP] Requesting book generation...');
      const r = await fetch(`/generate?keywords=${encodeURIComponent(kw)}&pages=${pg}`);
      const j = await r.json();
      append(j.ok ? '[HTTP] Generation complete.' : '[HTTP] Generation failed: ' + j.error);
    }
    function downloadBook() { location.href = '/download'; }
  </script>
</body>
</html>
